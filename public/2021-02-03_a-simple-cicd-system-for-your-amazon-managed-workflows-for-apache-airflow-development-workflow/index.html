<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <meta name="generator" content="Hugo 0.91.2" />
  <link rel="canonical" href="https://example.com/2021-02-03_a-simple-cicd-system-for-your-amazon-managed-workflows-for-apache-airflow-development-workflow/">

  

  
    
    
    
    
    

  
    <link rel="webmention" href="https://webmention.io/username.co.uk/webmention" />
    <link rel="pingback" href="https://webmention.io/username.co.uk/xmlrpc" />



  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#000000">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="https://example.com/css/syntax.css" media="none" onload="this.media='all';">

  
  
  <link rel="stylesheet" type="text/css" href="https://example.com/css/styles.css">

  
  
  <link rel="stylesheet" type="text/css" href="https://example.com/style.main.css">

  

  <link rel="alternate" rel="canonical" href="https://example.com/index.xml" >
  
  <style id="inverter" media="none">
    .intro-and-nav, .main-and-footer { filter: invert(100%) }
    * { background-color: inherit }
    img:not([src*=".svg"]), .colors, iframe, .demo-container { filter: invert(100%) }
  </style>

  
  
  <title>A simple CI/CD system for your Amazon Managed Workflows for Apache Airflow development workflow | Beachgeek blog - a refuge for pineapple on pizza lovers</title>

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="A simple CI/CD system for your Amazon Managed Workflows for Apache Airflow development workflow"/>
<meta name="twitter:description" content="updated Feb 19th
Part of a series of posts to support an up-coming online event, the Innovate AI/ML on February 24th, from 9:00am GMT - you can sign up here
 Part 1 - Installation and configuration of Managed Workflows for Apache Airflow Part 2 - Working with Permissions Part 3 - Accessing Amazon Managed Workflows for Apache Airflow Part 4 - Interacting with Amazon Managed Workflows for Apache Airflow via the command line Part 5 - A simple CI/CD system for your development workflow &lt;- this post Part 6 - Monitoring and logging Part 7 - Automating a simple AI/ML pipeline with Apache Airflow  In this post I will be covering Part 5, how you can setup a very simple CI/CD setup to enable faster development of your Apache Airflow DAGs."/>

  <meta name="twitter:card" content="summary" />
</head>

  <body>
    <a href="#main">skip to content</a>
    <svg style="display: none">
  <symbol id="bookmark" viewBox="0 0 40 50">
   <g transform="translate(2266 3206.2)">
    <path style="stroke:currentColor;stroke-width:3.2637;" d="m-2262.2-3203.4-.2331 42.195 16.319-16.318 16.318 16.318.2331-42.428z"/>
   </g>
  </symbol>

  <symbol id="w3c" viewBox="0 0 127.09899 67.763">
   <text font-size="83" style="font-size:83px;font-family:Trebuchet;letter-spacing:-12;fill-opacity:0" letter-spacing="-12" y="67.609352" x="-26.782778">W3C</text>
   <text font-size="83" style="font-size:83px;font-weight:bold;font-family:Trebuchet;fill-opacity:0" y="67.609352" x="153.21722" font-weight="bold">SVG</text>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m33.695.377 12.062 41.016 12.067-41.016h8.731l-19.968 67.386h-.831l-12.48-41.759-12.479 41.759h-.832l-19.965-67.386h8.736l12.061 41.016 8.154-27.618-3.993-13.397h8.737z"/>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m91.355 46.132c0 6.104-1.624 11.234-4.862 15.394-3.248 4.158-7.45 6.237-12.607 6.237-3.882 0-7.263-1.238-10.148-3.702-2.885-2.47-5.02-5.812-6.406-10.022l6.82-2.829c1.001 2.552 2.317 4.562 3.953 6.028 1.636 1.469 3.56 2.207 5.781 2.207 2.329 0 4.3-1.306 5.909-3.911 1.609-2.606 2.411-5.738 2.411-9.401 0-4.049-.861-7.179-2.582-9.399-1.995-2.604-5.129-3.912-9.397-3.912h-3.327v-3.991l11.646-20.133h-14.062l-3.911 6.655h-2.493v-14.976h32.441v4.075l-12.31 21.217c4.324 1.385 7.596 3.911 9.815 7.571 2.22 3.659 3.329 7.953 3.329 12.892z"/>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m125.21 0 1.414 8.6-5.008 9.583s-1.924-4.064-5.117-6.314c-2.693-1.899-4.447-2.309-7.186-1.746-3.527.73-7.516 4.938-9.258 10.13-2.084 6.21-2.104 9.218-2.178 11.978-.115 4.428.58 7.043.58 7.043s-3.04-5.626-3.011-13.866c.018-5.882.947-11.218 3.666-16.479 2.404-4.627 5.954-7.404 9.114-7.728 3.264-.343 5.848 1.229 7.841 2.938 2.089 1.788 4.213 5.698 4.213 5.698l4.94-9.837z"/>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m125.82 48.674s-2.208 3.957-3.589 5.48c-1.379 1.524-3.849 4.209-6.896 5.555-3.049 1.343-4.646 1.598-7.661 1.306-3.01-.29-5.807-2.032-6.786-2.764-.979-.722-3.486-2.864-4.897-4.854-1.42-2-3.634-5.995-3.634-5.995s1.233 4.001 2.007 5.699c.442.977 1.81 3.965 3.749 6.572 1.805 2.425 5.315 6.604 10.652 7.545 5.336.945 9.002-1.449 9.907-2.031.907-.578 2.819-2.178 4.032-3.475 1.264-1.351 2.459-3.079 3.116-4.108.487-.758 1.276-2.286 1.276-2.286l-1.276-6.644z"/>
  </symbol>

  <symbol id="tag" viewBox="0 0 177.16535 177.16535">
    <g transform="translate(0 -875.2)">
     <path style="fill-rule:evenodd;stroke-width:0;fill:currentColor" d="m159.9 894.3-68.79 8.5872-75.42 77.336 61.931 60.397 75.429-76.565 6.8495-69.755zm-31.412 31.835a10.813 10.813 0 0 1 1.8443 2.247 10.813 10.813 0 0 1 -3.5174 14.872l-.0445.0275a10.813 10.813 0 0 1 -14.86 -3.5714 10.813 10.813 0 0 1 3.5563 -14.863 10.813 10.813 0 0 1 13.022 1.2884z"/>
    </g>
  </symbol>

  <symbol id="balloon" viewBox="0 0 141.73228 177.16535">
   <g transform="translate(0 -875.2)">
    <g>
     <path style="fill:currentColor" d="m68.156 882.83-.88753 1.4269c-4.9564 7.9666-6.3764 17.321-5.6731 37.378.36584 10.437 1.1246 23.51 1.6874 29.062.38895 3.8372 3.8278 32.454 4.6105 38.459 4.6694-.24176 9.2946.2879 14.377 1.481 1.2359-3.2937 5.2496-13.088 8.886-21.623 6.249-14.668 8.4128-21.264 10.253-31.252 1.2464-6.7626 1.6341-12.156 1.4204-19.764-.36325-12.93-2.1234-19.487-6.9377-25.843-2.0833-2.7507-6.9865-7.6112-7.9127-7.8436-.79716-.20019-6.6946-1.0922-6.7755-1.0248-.02213.0182-5.0006-.41858-7.5248-.22808l-2.149-.22808h-3.3738z"/>
     <path style="fill:currentColor" d="m61.915 883.28-3.2484.4497c-1.7863.24724-3.5182.53481-3.8494.63994-2.4751.33811-4.7267.86957-6.7777 1.5696-.28598 0-1.0254.20146-2.3695.58589-5.0418 1.4418-6.6374 2.2604-8.2567 4.2364-6.281 7.6657-11.457 18.43-12.932 26.891-1.4667 8.4111.71353 22.583 5.0764 32.996 3.8064 9.0852 13.569 25.149 22.801 37.517 1.3741 1.841 2.1708 2.9286 2.4712 3.5792 3.5437-1.1699 6.8496-1.9336 10.082-2.3263-1.3569-5.7831-4.6968-21.86-6.8361-33.002-.92884-4.8368-2.4692-14.322-3.2452-19.991-.68557-5.0083-.77707-6.9534-.74159-15.791.04316-10.803.41822-16.162 1.5026-21.503 1.4593-5.9026 3.3494-11.077 6.3247-15.852z"/>
     <path style="fill:currentColor" d="m94.499 885.78c-.10214-.0109-.13691 0-.0907.0409.16033.13489 1.329 1.0675 2.5976 2.0723 6.7003 5.307 11.273 14.568 12.658 25.638.52519 4.1949.24765 14.361-.5059 18.523-2.4775 13.684-9.7807 32.345-20.944 53.519l-3.0559 5.7971c2.8082.76579 5.7915 1.727 8.9926 2.8441 11.562-11.691 18.349-19.678 24.129-28.394 7.8992-11.913 11.132-20.234 12.24-31.518.98442-10.02-1.5579-20.876-6.7799-28.959-.2758-.4269-.57803-.86856-.89617-1.3166-3.247-6.13-9.752-12.053-21.264-16.131-2.3687-.86369-6.3657-2.0433-7.0802-2.1166z"/>
     <path style="fill:currentColor" d="m32.52 892.22c-.20090-.13016-1.4606.81389-3.9132 2.7457-11.486 9.0476-17.632 24.186-16.078 39.61.79699 7.9138 2.4066 13.505 5.9184 20.562 5.8577 11.77 14.749 23.219 30.087 38.74.05838.059.12188.1244.18052.1838 1.3166-.5556 2.5965-1.0618 3.8429-1.5199-.66408-.32448-1.4608-1.3297-3.8116-4.4602-5.0951-6.785-8.7512-11.962-13.051-18.486-5.1379-7.7948-5.0097-7.5894-8.0586-13.054-6.2097-11.13-8.2674-17.725-8.6014-27.563-.21552-6.3494.13041-9.2733 1.775-14.987 2.1832-7.5849 3.9273-10.986 9.2693-18.07 1.7839-2.3656 2.6418-3.57 2.4409-3.7003z"/>
     <path style="fill:currentColor" d="m69.133 992.37c-6.2405.0309-12.635.76718-19.554 2.5706 4.6956 4.7759 9.935 10.258 12.05 12.625l4.1272 4.6202h11.493l3.964-4.4516c2.0962-2.3541 7.4804-7.9845 12.201-12.768-8.378-1.4975-16.207-2.6353-24.281-2.5955z"/>
     <rect style="stroke-width:0;fill:currentColor" ry="2.0328" height="27.746" width="22.766" y="1017.7" x="60.201"/>
    </g>
   </g>
  </symbol>

  <symbol id="info" viewBox="0 0 41.667 41.667">
   <g transform="translate(-37.035 -1004.6)">
    <path style="stroke-linejoin:round;stroke:currentColor;stroke-linecap:round;stroke-width:3.728;fill:none" d="m76.25 1030.2a18.968 18.968 0 0 1 -23.037 13.709 18.968 18.968 0 0 1 -13.738 -23.019 18.968 18.968 0 0 1 23.001 -13.768 18.968 18.968 0 0 1 13.798 22.984"/>
    <g transform="matrix(1.1146 0 0 1.1146 -26.276 -124.92)">
     <path style="stroke:currentColor;stroke-linecap:round;stroke-width:3.728;fill:none" d="m75.491 1039.5v-8.7472"/>
     <path style="stroke-width:0;fill:currentColor" transform="scale(-1)" d="m-73.193-1024.5a2.3719 2.3719 0 0 1 -2.8807 1.7142 2.3719 2.3719 0 0 1 -1.718 -2.8785 2.3719 2.3719 0 0 1 2.8763 -1.7217 2.3719 2.3719 0 0 1 1.7254 2.8741"/>
    </g>
   </g>
  </symbol>

  <symbol id="warning" viewBox="0 0 48.430474 41.646302">
    <g transform="translate(-1.1273 -1010.2)">
     <path style="stroke-linejoin:round;stroke:currentColor;stroke-linecap:round;stroke-width:4.151;fill:none" d="m25.343 1012.3-22.14 37.496h44.28z"/>
     <path style="stroke:currentColor;stroke-linecap:round;stroke-width:4.1512;fill:none" d="m25.54 1027.7v8.7472"/>
     <path style="stroke-width:0;fill:currentColor" d="m27.839 1042.8a2.3719 2.3719 0 0 1 -2.8807 1.7143 2.3719 2.3719 0 0 1 -1.718 -2.8785 2.3719 2.3719 0 0 1 2.8763 -1.7217 2.3719 2.3719 0 0 1 1.7254 2.8741"/>
    </g>
  </symbol>

  <symbol id="menu" viewBox="0 0 50 50">
     <rect style="stroke-width:0;fill:currentColor" height="10" width="50" y="0" x="0"/>
     <rect style="stroke-width:0;fill:currentColor" height="10" width="50" y="20" x="0"/>
     <rect style="stroke-width:0;fill:currentColor" height="10" width="50" y="40" x="0"/>
   </symbol>

   <symbol id="link" viewBox="0 0 50 50">
    <g transform="translate(0 -1002.4)">
     <g transform="matrix(.095670 0 0 .095670 2.3233 1004.9)">
      <g>
       <path style="stroke-width:0;fill:currentColor" d="m452.84 192.9-128.65 128.65c-35.535 35.54-93.108 35.54-128.65 0l-42.881-42.886 42.881-42.876 42.884 42.876c11.845 11.822 31.064 11.846 42.886 0l128.64-128.64c11.816-11.831 11.816-31.066 0-42.9l-42.881-42.881c-11.822-11.814-31.064-11.814-42.887 0l-45.928 45.936c-21.292-12.531-45.491-17.905-69.449-16.291l72.501-72.526c35.535-35.521 93.136-35.521 128.64 0l42.886 42.881c35.535 35.523 35.535 93.141-.001 128.66zm-254.28 168.51-45.903 45.9c-11.845 11.846-31.064 11.817-42.881 0l-42.884-42.881c-11.845-11.821-11.845-31.041 0-42.886l128.65-128.65c11.819-11.814 31.069-11.814 42.884 0l42.886 42.886 42.876-42.886-42.876-42.881c-35.54-35.521-93.113-35.521-128.65 0l-128.65 128.64c-35.538 35.545-35.538 93.146 0 128.65l42.883 42.882c35.51 35.54 93.11 35.54 128.65 0l72.496-72.499c-23.956 1.597-48.092-3.784-69.474-16.283z"/>
      </g>
     </g>
    </g>
  </symbol>

  <symbol id="doc" viewBox="0 0 35 45">
   <g transform="translate(-147.53 -539.83)">
    <path style="stroke:currentColor;stroke-width:2.4501;fill:none" d="m149.38 542.67v39.194h31.354v-39.194z"/>
    <g style="stroke-width:25" transform="matrix(.098003 0 0 .098003 133.69 525.96)">
     <path d="m220 252.36h200" style="stroke:currentColor;stroke-width:25;fill:none"/>
     <path style="stroke:currentColor;stroke-width:25;fill:none" d="m220 409.95h200"/>
     <path d="m220 488.74h200" style="stroke:currentColor;stroke-width:25;fill:none"/>
     <path d="m220 331.15h200" style="stroke:currentColor;stroke-width:25;fill:none"/>
    </g>
   </g>
 </symbol>

 <symbol id="tick" viewBox="0 0 177.16535 177.16535">
  <g transform="translate(0 -875.2)">
   <rect style="stroke-width:0;fill:currentColor" transform="rotate(30)" height="155" width="40" y="702.99" x="556.82"/>
   <rect style="stroke-width:0;fill:currentColor" transform="rotate(30)" height="40" width="90.404" y="817.99" x="506.42"/>
  </g>
 </symbol>
</svg>

    <div class="wrapper">
      <header class="intro-and-nav" role="banner">
  <div>
    <div class="intro">
      <a class="logo" href="https://example.com" aria-label="Beachgeek blog - a refuge for pineapple on pizza lovers home page">
        <img src="https://example.com/images/logo.svg" alt="My site icon">
      </a>
      <p class="library-desc">
         Technologist and Maker specialising in Cloud, Open Source and Innovation &amp; Emerging Technologies. 
      </p>
    </div>
    <nav id="patterns-nav" class="patterns" role="navigation">
  <h2 class="vh">Main navigation</h2>
  <button id="menu-button" aria-expanded="false">
    <svg viewBox="0 0 50 50" aria-hidden="true" focusable="false">
      <use xlink:href="#menu"></use>
    </svg>
    Menu
  </button>
  
  <ul id="patterns-list">
  
    <li class="pattern">
      
      
      
      
      <a href="/" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use xlink:href="#bookmark"></use>
        </svg>
        <span class="text">Home</span>
      </a>
    </li>
  
    <li class="pattern">
      
      
      
      
      <a href="/newsletter/" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use xlink:href="#bookmark"></use>
        </svg>
        <span class="text">Newsletter</span>
      </a>
    </li>
  
    <li class="pattern">
      
      
      
      
      <a href="/tags/" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use xlink:href="#bookmark"></use>
        </svg>
        <span class="text">Tags</span>
      </a>
    </li>
  
    <li class="pattern">
      
      
      
      
      <a href="/about/" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use xlink:href="#bookmark"></use>
        </svg>
        <span class="text">About</span>
      </a>
    </li>
  
    <li class="pattern">
      
      
      
      
      <a href="/index.xml" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use xlink:href="#bookmark"></use>
        </svg>
        <span class="text">RSS</span>
      </a>
    </li>
  
  </ul>
</nav>
  </div>
</header>

      <div class="main-and-footer">
        <div>
          
  <main id="main">
    <h1>
      <svg class="bookmark-icon" aria-hidden="true" viewBox="0 0 40 50" focusable="false">
        <use xlink:href="#bookmark"></use>
      </svg>
      A simple CI/CD system for your Amazon Managed Workflows for Apache Airflow development workflow
    </h1>

    <div class="date">
      <p>
        
        <svg role="img" xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" viewBox="0 0 24 24" aria-labelledby="calendarIconTitle" stroke="#111" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" fill="none" color="#111"> <title id="calendarIconTitle">Calendar</title> <path d="M3 5H21V21H3V5Z"/> <path d="M21 9H3"/> <path d="M7 5V3"/> <path d="M17 5V3"/> </svg> Published Feb 3, 2021
      </p>
      
      <p><svg role="img" xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" viewBox="0 0 24 24" aria-labelledby="stopwatchIconTitle" stroke="#111" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" fill="none" color="#111"> <title id="stopwatchIconTitle">Stopwatch</title> <circle cx="12" cy="13" r="8"/> <path d="M12 9L12 13M18 7L20 5M15 2L9 2"/> </svg> Reading time 16&nbsp;minutes</p>
      
    </div>

    
    
    
      


    

    <p><strong>updated Feb 19th</strong></p>
<p><img src="https://raw.githubusercontent.com/094459/innovateaiml-airflow/main/images/banner.png" alt="innovate"></p>
<p>Part of a series of posts to support an up-coming online event, the Innovate AI/ML on February 24th, from 9:00am GMT - you can sign up <a href="https://aws.amazon.com/events/aws-innovate/machine-learning/online/emea/?sc_channel=em&amp;sc_campaign=EMEA_FIELD_WEBINAR_innovate-AIML_20210224_7014z000001MJbu&amp;sc_medium=em_&amp;sc_content=REG_t1_field&amp;sc_geo=emea&amp;sc_country=mult&amp;sc_outcome=reg&amp;sc_publisher=aws&amp;trkCampaign=emea21_innovatemlq1&amp;trk=em_emea21_innovatemlq1_ricardosueiras">here</a></p>
<ul>
<li><strong>Part 1</strong> - <a href="https://aws-oss.beachgeek.co.uk/3h">Installation and configuration of Managed Workflows for Apache Airflow</a></li>
<li><strong>Part 2</strong> - <a href="https://aws-oss.beachgeek.co.uk/3n">Working with Permissions</a></li>
<li><strong>Part 3</strong> - <a href="https://aws-oss.beachgeek.co.uk/3o">Accessing Amazon Managed Workflows for Apache Airflow</a></li>
<li><strong>Part 4</strong> - <a href="https://aws-oss.beachgeek.co.uk/4s">Interacting with Amazon Managed Workflows for Apache Airflow via the command line</a></li>
<li><strong>Part 5</strong> - A simple CI/CD system for your development workflow &lt;- this post</li>
<li><strong>Part 6</strong> - <a href="https://aws-oss.beachgeek.co.uk/5r">Monitoring and logging</a></li>
<li><strong>Part 7</strong> - Automating a simple AI/ML pipeline with Apache Airflow</li>
</ul>
<p>In this post I will be covering Part 5, how you can setup a very simple CI/CD setup to enable faster development of your Apache Airflow DAGs. Specifically I will cover a couple of things:</p>
<ol>
<li>Setting up the repository and build pipeline</li>
<li>Taking a look at the workflow</li>
</ol>
<p><strong>What will you need</strong></p>
<ul>
<li>An AWS account with the right level of privileges</li>
<li>An environment with the AWS CLI tools configured and running</li>
<li>Access to an AWS region where Managed Workflows for Apache Airflow is supported</li>
<li>An environment of Amazon Managed Workflows for Apache Airflow already setup - you should ideally have followed <a href="https://aws-oss.beachgeek.co.uk/3h">part one here</a>.</li>
</ul>
<p><strong>An example workflow</strong></p>
<p>If you examine how MWAA picks up DAGs and supporting files, we know that we have a directory structure that will look similar to this. You MWAA environment will have a root Amazon S3 bucket that is prefixed &ldquo;airflow-&rdquo; and within that you will have a dags folder into which you will deploy your actual DAGs. You may also be using requirements.txt to load up additional python libraries or maybe have some custom plugins (you can read more about that <a href="https://docs.aws.amazon.com/mwaa/latest/userguide/configuring-dag-import-plugins.html">here</a>)</p>
<pre><code>.
└── airflow-bucket
    ├── dags
    │   └── example-hello.py
    ├── plugins.zip
    └── requirements.txt
</code></pre>
<p>As a development lifecycle, we want to simplify the process of moving workflows from developers to MWAA, and we want to minimise manual steps that they should use (such as manually copying the files to S3 either via the console or command line). We also want to ensure that the workflows (which is just python code) is checked into source control.</p>
<p>Many organisations use CI/CD pipelines to help automate the process of taking code from source code and then after going through defined validation, testing or other steps, is then deployed into the final target destination - in this case, we want the target to be the airflow-bucket that we have defined.</p>
<p>In this post we will walk you through setting this up so you can use this as a basis for your own ideas on how you can do this yourself. I will start off with setting up a source code repository - I am going to assume you want might want a private repo and so will use something like AWS CodeCommit, but you could equally use public repos like GitHub so feel free to adapt/adjust as it should work the same.</p>
<p>We will setup a very simple workflow that takes every commit we do in our source code repository, and then syncs that code to the target DAGs folder where MWAA will pick it up.</p>
<p><strong>Setting up the pipeline</strong></p>
<p>I am going to use AWS CloudFormation again to set this up. To help us we need a supporting resource, which will be used to propagate the initial repository. You will find all the resources in the GitHub repository <a href="https://github.com/094459/innovateaiml-airflow/tree/main/cf">here</a>. You will need the following files in this walkthrough:</p>
<pre><code>create-cicd-simple.yaml
mwaa-cfn-cici-parameters.json
</code></pre>
<p>The first step is to create the initial rep initialisation file that we need to provide to CloudFormation so it can create the repository. (You can do this manually via the AWS Console, and you will then not need to do this). Using the above directory structure above we can do:</p>
<pre><code>$ cd airflow-bucket
$ zip -r dags.zip dags 
</code></pre>
<p>which will create a zip with a directory structure as follows</p>
<pre><code> dags
  └── example-hello.py
</code></pre>
<p>Once we have this file, we can upload this to your MWAA airflow bucket. You can change this when you use this yourself in the CloudFormation script (lines 34/35 in the template)</p>
<pre><code>aws s3 cp dags.zip s3://{mwaa-dag-folder}
</code></pre>
<p>We can now modify the parameters file to suit our environment. In this example, I am going to use the following variables which represent my environment: AWS Region is eu-north-1, MWAA environment name is going to be airflow-blog-stock, my MWAA S3 dag folder is airflow-blog-stock-cicd.</p>
<p>In the parameter file you will only use the dag folder being needed. The other values (CodeCommitRepoName, CodePipelineName and CodeBuildProjectName) you can change to values you typically use.</p>
<pre><code>[
    {
      &quot;ParameterKey&quot;: &quot;s3BucketName&quot;,
      &quot;ParameterValue&quot;: &quot;airflow-blog-stock-cicd&quot;
    }, 
    {
      &quot;ParameterKey&quot;: &quot;CodeCommitRepoName&quot;,
      &quot;ParameterValue&quot;: &quot;airflow-stock-repo-demo&quot;
    },
    {
      &quot;ParameterKey&quot;: &quot;CodePipelineName&quot;,
      &quot;ParameterValue&quot;: &quot;airflow-stock-pipe-demo&quot;
    },
    {
      &quot;ParameterKey&quot;: &quot;CodeBuildProjectName&quot;,
      &quot;ParameterValue&quot;: &quot;airflow-stock-buildprj-demo&quot;
      }
]
</code></pre>
<p>Once you have saved that, you are ready to go. You should not need to modify the CloudFormation template. To deploy, use the following command, replacing the values in { } with your preferred values.</p>
<pre><code>aws cloudformation create-stack --stack-name {your-cf-stack-name} --template-body file://create-cicd-simple.yaml --parameters file://mwaa-cfn-cicd-parameters.json --capabilities CAPABILITY_IAM --capabilities CAPABILITY_NAMED_IAM --region={MWAA supported AWS region}
</code></pre>
<p>When you run this, you should see the following output</p>
<pre><code>{
    &quot;StackId&quot;: &quot;arn:aws:cloudformation:{aws-region}:{aws-account-id}:stack/{your-cf-stack-name}/b7255750-65f6-11eb-b32a-06106702d484&quot;
}
</code></pre>
<p>And if you go into the AWS CloudFormation console, you should see this stack being created. It should only take around 3-5 minutes to complete. If you run the following command, you should see all the resources that have been created.</p>
<pre><code>aws cloudformation describe-stack-resources --stack-name {your-cf-stack-name} --region={MWAA supported AWS region}
</code></pre>
<p>You should see something like the following:</p>
<pre><code>{
    &quot;StackResources&quot;: [
        {
            &quot;StackName&quot;:{aws-mwaa-region} &quot;{cf stack name}&quot;,
            &quot;StackId&quot;: &quot;arn:aws:cloudformation:{aws-mwaa-region}:{aws-account-id}:stack/{cf stack name}/b7255750-65f6-11eb-b32a-06106702d484&quot;,
            &quot;LogicalResourceId&quot;: &quot;ArtifactStoreBucket&quot;,
            &quot;PhysicalResourceId&quot;: &quot;{cf stack name}-artifactstorebucket-1me3gxwb6p2p&quot;,
            &quot;ResourceType&quot;: &quot;AWS::S3::Bucket&quot;,
            &quot;Timestamp&quot;: &quot;2021-02-03T08:06:54.421Z&quot;,
            &quot;ResourceStatus&quot;: &quot;CREATE_COMPLETE&quot;,
            &quot;DriftInformation&quot;: {
                &quot;StackResourceDriftStatus&quot;: &quot;NOT_CHECKED&quot;
            }
        },
        {
            &quot;StackName&quot;: &quot;{cf stack name}&quot;,
            &quot;StackId&quot;: &quot;arn:aws:cloudformation:{aws-mwaa-region}:{aws-account-id}:stack/{cf stack name}/b7255750-65f6-11eb-b32a-06106702d484&quot;,
            &quot;LogicalResourceId&quot;: &quot;CodeBuildProject&quot;,
            &quot;PhysicalResourceId&quot;: &quot;airflow-stock-buildprj-demo&quot;,
            &quot;ResourceType&quot;: &quot;AWS::CodeBuild::Project&quot;,
            &quot;Timestamp&quot;: &quot;2021-02-03T08:07:21.691Z&quot;,
            &quot;ResourceStatus&quot;: &quot;CREATE_COMPLETE&quot;,
            &quot;DriftInformation&quot;: {
                &quot;StackResourceDriftStatus&quot;: &quot;NOT_CHECKED&quot;
            }
        },
        {
            &quot;StackName&quot;: &quot;{cf stack name}&quot;,
            &quot;StackId&quot;: &quot;arn:aws:cloudformation:{aws-mwaa-region}:{aws-account-id}:stack/{cf stack name}/b7255750-65f6-11eb-b32a-06106702d484&quot;,
            &quot;LogicalResourceId&quot;: &quot;CodeBuildRole&quot;,
            &quot;PhysicalResourceId&quot;: &quot;{cf stack name}-CodeBuildRole-1LG9K7WF8BICD&quot;,
            &quot;ResourceType&quot;: &quot;AWS::IAM::Role&quot;,
            &quot;Timestamp&quot;: &quot;2021-02-03T08:07:17.347Z&quot;,
            &quot;ResourceStatus&quot;: &quot;CREATE_COMPLETE&quot;,
            &quot;DriftInformation&quot;: {
                &quot;StackResourceDriftStatus&quot;: &quot;NOT_CHECKED&quot;
            }
        },
        {
            &quot;StackName&quot;: &quot;{cf stack name}&quot;,
            &quot;StackId&quot;: &quot;arn:aws:cloudformation:{aws-mwaa-region}:{aws-account-id}:stack/{cf stack name}/b7255750-65f6-11eb-b32a-06106702d484&quot;,
            &quot;LogicalResourceId&quot;: &quot;CodeCommitRepository&quot;,
            &quot;PhysicalResourceId&quot;: &quot;cb101164-7647-42a1-a0a1-6c734eee2bfd&quot;,
            &quot;ResourceType&quot;: &quot;AWS::CodeCommit::Repository&quot;,
            &quot;Timestamp&quot;: &quot;2021-02-03T08:06:34.719Z&quot;,
            &quot;ResourceStatus&quot;: &quot;CREATE_COMPLETE&quot;,
            &quot;DriftInformation&quot;: {
                &quot;StackResourceDriftStatus&quot;: &quot;NOT_CHECKED&quot;
            }
        },
        {
            &quot;StackName&quot;: &quot;{cf stack name}&quot;,
            &quot;StackId&quot;: &quot;arn:aws:cloudformation:{aws-mwaa-region}:{aws-account-id}:stack/{cf stack name}/b7255750-65f6-11eb-b32a-06106702d484&quot;,
            &quot;LogicalResourceId&quot;: &quot;CodePielineEventExeRole&quot;,
            &quot;PhysicalResourceId&quot;: &quot;{cf stack name}-CodePielineEventExeRole-QZZZ03I2NTFS&quot;,
            &quot;ResourceType&quot;: &quot;AWS::IAM::Role&quot;,
            &quot;Timestamp&quot;: &quot;2021-02-03T08:06:53.046Z&quot;,
            &quot;ResourceStatus&quot;: &quot;CREATE_COMPLETE&quot;,
            &quot;DriftInformation&quot;: {
                &quot;StackResourceDriftStatus&quot;: &quot;NOT_CHECKED&quot;
            }
        },
        {
            &quot;StackName&quot;: &quot;{cf stack name}&quot;,
            &quot;StackId&quot;: &quot;arn:aws:cloudformation:{aws-mwaa-region}:{aws-account-id}:stack/{cf stack name}/b7255750-65f6-11eb-b32a-06106702d484&quot;,
            &quot;LogicalResourceId&quot;: &quot;CodePipelinePipeline&quot;,
            &quot;PhysicalResourceId&quot;: &quot;airflow-stock-pipe-demo&quot;,
            &quot;ResourceType&quot;: &quot;AWS::CodePipeline::Pipeline&quot;,
            &quot;Timestamp&quot;: &quot;2021-02-03T08:06:57.951Z&quot;,
            &quot;ResourceStatus&quot;: &quot;CREATE_COMPLETE&quot;,
            &quot;DriftInformation&quot;: {
                &quot;StackResourceDriftStatus&quot;: &quot;NOT_CHECKED&quot;
            }
        },
        {
            &quot;StackName&quot;: &quot;{cf stack name}&quot;,
            &quot;StackId&quot;: &quot;arn:aws:cloudformation:{aws-mwaa-region}:{aws-account-id}:stack/{cf stack name}/b7255750-65f6-11eb-b32a-06106702d484&quot;,
            &quot;LogicalResourceId&quot;: &quot;PipelineRole&quot;,
            &quot;PhysicalResourceId&quot;: &quot;{cf stack name}-PipelineRole-1MIR8Y4TZRCTB&quot;,
            &quot;ResourceType&quot;: &quot;AWS::IAM::Role&quot;,
            &quot;Timestamp&quot;: &quot;2021-02-03T08:06:53.984Z&quot;,
            &quot;ResourceStatus&quot;: &quot;CREATE_COMPLETE&quot;,
            &quot;DriftInformation&quot;: {
                &quot;StackResourceDriftStatus&quot;: &quot;NOT_CHECKED&quot;
            }
        }
    ]
}
</code></pre>
<p>This will set everything up, and if you go to the AWS CodePipeline console, you should be able to see your simple CI/CD pipeline.</p>
<p><img src="https://raw.githubusercontent.com/094459/innovateaiml-airflow/main/images/cicd-screen.png" alt="screen"></p>
<p>Now the first time you go to this console, you might see the build fail. Don&rsquo;t worry, if you click on the Retry it should complete successfully. (and I will be looking into this to see if I can fix the template to see if this is expected behaviour or a problem with this template)</p>
<p><strong>Testing this within our developer environments</strong></p>
<p>Now that we have this setup, lets test this setup using a number of typical developer scenarios you might have.</p>
<p>To get details of the AWS CodeCommit repository details, we use the following command to find the list of repositories.</p>
<pre><code>aws codecommit list-repositories --region={region}
</code></pre>
<p>and then use this command once you know the repository name</p>
<pre><code>aws codecommit get-repository --repository-name --region={region}
</code></pre>
<p>which will display useful information, including the cloneURL</p>
<pre><code>{
    &quot;repositoryMetadata&quot;: {
        &quot;accountId&quot;: &quot;{aws-account-id}&quot;,
        &quot;repositoryId&quot;: &quot;c4a4ac66-6bfc-419c-a145-bbb0a4606a05&quot;,
        &quot;repositoryName&quot;: &quot;{repo-name}&quot;,
        &quot;defaultBranch&quot;: &quot;main&quot;,
        &quot;lastModifiedDate&quot;: 1612343158.702,
        &quot;creationDate&quot;: 1610969080.447,
        &quot;cloneUrlHttp&quot;: &quot;https://git-codecommit.{aws-region}.amazonaws.com/v1/repos/{repo-name}&quot;,
        &quot;cloneUrlSsh&quot;: &quot;ssh://git-codecommit.{aws-region}.amazonaws.com/v1/repos/{repo-name}&quot;,
        &quot;Arn&quot;: &quot;arn:aws:codecommit:{aws-region}:{aws-account-id}:{repo-name}&quot;
    }
}
</code></pre>
<p>So now we have the repo URL, we can check out the project into our development environment and begin working.</p>
<p><strong>Git</strong></p>
<p>From my developer laptop, I open up my preferred shell and use the following command to check out the repository</p>
<pre><code>mkdir airflow-cicd
cd airflow-cicd
git clone https://git-codecommit.eu-north-1.amazonaws.com/v1/repos/airflow-stock-repo-demo

</code></pre>
<p>I will get the normal output</p>
<pre><code>Cloning into 'airflow-stock-repo-demo'...
remote: Counting objects: 8, done.
Unpacking objects: 100% (8/8), done.
</code></pre>
<p>And you can see that I have the following directory structure</p>
<pre><code>└── airflow-stock-repo-demo
    └── dags
        ├── db_cleanup.py
        └── example-params.py
</code></pre>
<p>I am going to create a test file, using an example dag file that is a simple HelloWorld dag (file called hello-world.py)</p>
<pre><code>└── airflow-stock-repo-demo
    └── dags
        ├── db_cleanup.py
        ├── example-params.py
        └── hello-world.py
</code></pre>
<p>If we look at the current DAGs folder that the MWAA environment has deployed, we can see the following (with my MWAA Airflow dags folder configured to the one here, yours will be different):</p>
<pre><code>aws s3 ls s3://airflow-blogpostdemo-stock/dags/
</code></pre>
<p>And we can see we get the following:</p>
<pre><code>2021-02-03 10:06:43       2890 db_cleanup.py
2021-02-03 10:06:43       2222 example_params.py
</code></pre>
<p>If we now commit the new file using standard git commands.</p>
<pre><code>git add .
git commit -m &quot;adding hellow-world.py&quot;
git push
</code></pre>
<p>Which should show something like this</p>
<pre><code>Enumerating objects: 6, done.
Counting objects: 100% (6/6), done.
Delta compression using up to 12 threads
Compressing objects: 100% (2/2), done.
Writing objects: 100% (4/4), 308 bytes | 308.00 KiB/s, done.
Total 4 (delta 1), reused 0 (delta 0)
To https://git-codecommit.eu-north-1.amazonaws.com/v1/repos/airflow-stock-repo-demo
   f895090..1577b18  main -&gt; main
</code></pre>
<p>when we re-run the following command</p>
<pre><code>aws s3 ls s3://airflow-blogpostdemo-stock/dags/
</code></pre>
<p>And we can see we get the following:</p>
<pre><code>2021-02-03 10:06:43       2890 db_cleanup.py
2021-02-03 10:06:43       2222 example_params.py
2021-02-03 10:06:43       122 hello-world.py

</code></pre>
<p>What just happened?</p>
<p>The commit in the source code repository triggered an event which in turn triggered the AWS CodePipeline pipeline. That pipeline checks out the code repository locally and then does an aws s3 sync to our target folder, in this case the DAGS target folder.</p>
<p><strong>Apache Airflow UI</strong></p>
<p>The new file will now appear in the MWAA environment you have been using, although it might take a minute or two. The process that is going on in the background is that the MWAA S3 bucket is synced on a regular basis with the DAGS folder of your Apache Airflow environment, and this is done typically every 30 seconds.</p>
<p>If your DAG is written correctly and well formed, it should show up. However, when I was developing some test DAGs I would often commit my change, and then I would see various error messages appear on the Apache Airflow UI. If this happens, then make sure that you a) enable logging, and b) check out the CloudWatch logs to find out more information as to the issue. We will look at monitoring and logging in the next post.</p>
<p><strong>Other developer environments</strong></p>
<p>I have tested this setup using VSCode (my standard IDE) as well as AWS Cloud9 (my preferred IDE) and these steps works the same way. If you are using the VSCode git plugin it is super easy to work with your AWS CodeCommit repository.</p>
<p><strong>Other Source Code repositories</strong></p>
<p>During this demo I used AWS CodeCommit as the source repository, but what about if you were using something different like Bitbucket, GitHub or perhaps GitHub Enterprise.</p>
<p>You can set these up, but you will not be able to use the sample templates I have provided. Some of the integration will need to be done via the AWS console, so check out the documentation around <a href="https://docs.aws.amazon.com/codepipeline/latest/userguide/connections-bitbucket.html">Bitbucket</a>, <a href="https://docs.aws.amazon.com/codepipeline/latest/userguide/connections-github.html">GitHub</a> and G<a href="https://docs.aws.amazon.com/codepipeline/latest/userguide/connections-ghes.html">itHub Enterprise</a>.</p>
<p>Once you follow these steps, you should still be able to automate the triggering of the &ldquo;build&rdquo; stage, which is syncing with your MWAA DAG folder.</p>
<p><strong>Deleting</strong></p>
<p>In the above configuration, deletes will not sync to your DAGS folder on Amazon S3. If you want to enable this, then you need to do a couple of things:</p>
<p>First, you need to adjust the permissions policy to allow permissions for the CodePipeline/Build execution role to have s3 Delete privileges.
Second, you need to change the command to append the &ldquo;&ndash;delete&rdquo; which will delete files that are not in the source. So if we use the example above, your build command would be</p>
<pre><code>- aws s3 sync . s3://${s3BucketName}/ --exclude &quot;plugin-src/* --delete&quot;
</code></pre>
<p><strong>Plugins</strong></p>
<p>One of the really nice things about Apache Airflow is the ability to extend the functionality and cater for anything more specific you might need to do. This could be for example, creating a custom operator for an internal system you need to interact with. You can read more about how MWAA supports this here, <a href="https://docs.aws.amazon.com/mwaa/latest/userguide/configuring-dag-import-plugins.html">Installing custom plugins</a>.</p>
<p>We can quickly change the setup so that it packages and deploys your plugins.zip file. Lets say you had this layout in your repository, and you have developed your custom plugin within the plugins-src folder</p>
<pre><code>└── airflow-stock-repo-demo
    └── dags
        ├── db_cleanup.py
    └─  plugins-src
            		├-__init__.py
						└-my_airflow_plugin.py
						└-hooks/
 						   	|-- __init__.py
						   	|-- my_airflow_hook.py
						└-operators/
 						   	|-- __init__.py
						   	|-- my_airflow_operator.py
						└-sensors/
    							|-- __init__.py
    							|-- my_airflow_sensor.py
	 ├── requirements.txt
	 └── plugins.zip
</code></pre>
<p>We can modify the build command to include packaging this up as a zip file and then deploying this using the following</p>
<pre><code>...
              BuildSpec: !Sub |
                version: 0.2
                phases:
                  build:
                    commands:
                      - cd plugin-src
                      - chmod -R 755 .
                      - zip -r plugins.zip .
                      - aws s3 cp plugins.zip s3://${s3BucketName}/
                      - rm plugins.zip
                      - cd ..
                      - aws s3 sync . s3://${s3BucketName}/ --exclude &quot;plugin-src/*&quot;
...
</code></pre>
<p>If you have already deployed the template, you can go to the CodeBuild stage and edit the build command directly. (feel free to change the folder structure to whatever suits your needs/requirements)</p>
<p>This will now take the code it finds in the plugin-src, zip it up and then deploy it to the root folder. It specifically excludes the source file when moving the content to the MWAA Dags folders with the &ndash;exclude.  With this setup, you would then need to configure the MWAA environment to use this plugin.zip file if you had not already done so. As you update/change the plugin.zip file, this will create a new version of the file rather than replace it. This means that even if you restart your MWAA environment, it will still point to the old file. You will need to update the plugins.zip file that your environment points to.</p>
<pre><code>aws s3api list-object-versions --bucket {plugin-folder} --prefix plugins.zip
</code></pre>
<p>which will give you something like (in this example, I have two versions of the plugins.zip file)</p>
<pre><code>{
    &quot;Versions&quot;: [
        {
            &quot;ETag&quot;: &quot;\&quot;4091a3ef43ca1a5d37353dae745c6eb6\&quot;&quot;,
            &quot;Size&quot;: 4916,
            &quot;StorageClass&quot;: &quot;STANDARD&quot;,
            &quot;Key&quot;: &quot;plugins.zip&quot;,
            &quot;VersionId&quot;: &quot;1yzdinP0EnHNLe9LF6zWSpUbiX5aYqhY&quot;,
            &quot;IsLatest&quot;: true,
            &quot;LastModified&quot;: &quot;2021-02-17T18:06:14.000Z&quot;,
            &quot;Owner&quot;: {
                &quot;DisplayName&quot;: &quot;ricsue&quot;,
                &quot;ID&quot;: &quot;de88fb921565d9a1fb139460924e49f5286d7c2fa6499a685c257f9315db8a7c&quot;
            }
        },
        {
            &quot;ETag&quot;: &quot;\&quot;813a3e1b6cb7e750bad322ed09d7426f\&quot;&quot;,
            &quot;Size&quot;: 5116,
            &quot;StorageClass&quot;: &quot;STANDARD&quot;,
            &quot;Key&quot;: &quot;plugins.zip&quot;,
            &quot;VersionId&quot;: &quot;fTNV1wTeB9.0HrI9SKo_iR_f751Vs1Ac&quot;,
            &quot;IsLatest&quot;: false,
            &quot;LastModified&quot;: &quot;2021-02-17T17:18:43.000Z&quot;,
            &quot;Owner&quot;: {
                &quot;DisplayName&quot;: &quot;ricsue&quot;,
                &quot;ID&quot;: &quot;de88fb921565d9a1fb139460924e49f5286d7c2fa6499a685c257f9315db8a7c&quot;
            }
        }
    ]
}
</code></pre>
<p>To see the current version you are using, use the following command:</p>
<pre><code>aws mwaa get-environment --name {mwaa-environment} | jq -r '.Environment | .PluginsS3ObjectVersion'
</code></pre>
<p>which will get you the current version that is being used, in my example I get the following output.</p>
<pre><code>fTNV1wTeB9.0HrI9SKo_iR_f751Vs1Ac
</code></pre>
<p>Which you can see from the previous output is not the latest version of the plugins.zip file (that is &ldquo;1yzdinP0EnHNLe9LF6zWSpUbiX5aYqhY&rdquo;). I can fix that by running the following command:</p>
<pre><code>aws mwaa update-environment --plugins-s3-object-version &quot;1yzdinP0EnHNLe9LF6zWSpUbiX5aYqhY&quot; --name {your-mwaa-environment}
</code></pre>
<p>which will output something like this</p>
<pre><code>{
    &quot;Arn&quot;: &quot;arn:aws:airflow:eu-west-1:xxxxxxxxxx:environment/{your-mwaa-env}&quot;
}
</code></pre>
<p>This will update and then update the environment - so this can take around 10-15 minutes to complete. Go and grab a cup of tea. When we run the previous command to see the status of the environment,</p>
<pre><code>aws mwaa get-environment --name {mwaa-environment} | jq -r '.Environment | .RequirementsS3ObjectVersion'
</code></pre>
<p>We should now see the latest version being used.</p>
<pre><code>V6.0mTeeI0v4ctTubAgvNrGqIdj3b4LV
</code></pre>
<p><strong>Requirements.txt</strong></p>
<p>As this is a static file, you could use the existing approach and ensure that your directory structure is such that it syncs both the DAGS folder and the requirements.txt file to the target MWAA Dags folder to the corresponding locations.</p>
<p>So for example, if you MWAA environment has something like this:</p>
<pre><code>└── airflow-stock-repo-demo
    └── dags
        ├── db_cleanup.py
	 └── requirements.txt
</code></pre>
<p>You would set your folder structure in the code repository to match this, and the requirements.txt file would sync every time you updated it.</p>
<p>One thing that caught me out here was that because the requirements.txt file is uploaded/overwrites your existing file, and it is a versioned bucket, the process of doing this will not automatically update the configuration within your MWAA environment. You can use the aws cli to output all the versions of the file, using a command like (I am assuming here you have a folder called requirements and your requirements.txt file in located there - if yours is different, adjust accordingly):</p>
<pre><code>aws s3api list-object-versions --bucket {your S3 bucket where the requirements.txt is} --prefix requirements/requirements.txt
</code></pre>
<p>Which gives you this output - yours will be different:</p>
<pre><code>...

    &quot;Versions&quot;: [
        {
            &quot;ETag&quot;: &quot;\&quot;20945e5c4596619a7e8c94150b715e60\&quot;&quot;,
            &quot;Size&quot;: 54,
            &quot;StorageClass&quot;: &quot;STANDARD&quot;,
            &quot;Key&quot;: &quot;requirements/requirements.txt&quot;,
            &quot;VersionId&quot;: &quot;V6.0mTeeI0v4ctTubAgvNrGqIdj3b4LV&quot;,
            &quot;IsLatest&quot;: true,
            &quot;LastModified&quot;: &quot;2021-02-17T15:04:08.000Z&quot;,
            &quot;Owner&quot;: {
                &quot;DisplayName&quot;: &quot;ricsue&quot;,
                &quot;ID&quot;: &quot;de88fb921565d9a1fb139460924e49f5286d7c2fa6499a685c257f9315db8a7c&quot;
            }
        },
        {
            &quot;ETag&quot;: &quot;\&quot;538aa1a28441582eb0dfff30e76cbae5\&quot;&quot;,
            &quot;Size&quot;: 48,
            &quot;StorageClass&quot;: &quot;STANDARD&quot;,
            &quot;Key&quot;: &quot;requirements/requirements.txt&quot;,
            &quot;VersionId&quot;: &quot;glbJdJ06NTvd48pohr9wuUTZ3z7Rg4KC&quot;,
            &quot;IsLatest&quot;: false,
            &quot;LastModified&quot;: &quot;2021-02-17T14:37:53.000Z&quot;,
            &quot;Owner&quot;: {
                &quot;DisplayName&quot;: &quot;ricsue&quot;,
                &quot;ID&quot;: &quot;de88fb921565d9a1fb139460924e49f5286d7c2fa6499a685c257f9315db8a7c&quot;
            }
        },
...
</code></pre>
<p>Now it is the versionId that you need to use. In the above example, I have just updated my requirements.rxt file. If I run the following command:</p>
<pre><code>aws mwaa get-environment --name {mwaa-environment} | jq -r '.Environment | .RequirementsS3ObjectVersion'
</code></pre>
<p>I get the following output</p>
<pre><code>glbJdJ06NTvd48pohr9wuUTZ3z7Rg4KC
</code></pre>
<p>Which you can see from the previous output is not the latest version of the requirements.txt file (that is &ldquo;V6.0mTeeI0v4ctTubAgvNrGqIdj3b4LV&rdquo;). I can fix that by running the following command:</p>
<pre><code>aws mwaa update-environment --requirements-s3-object-version &quot;V6.0mTeeI0v4ctTubAgvNrGqIdj3b4LV&quot; --name {your-mwaa-environment}
</code></pre>
<p>which will output something like this</p>
<pre><code>{
    &quot;Arn&quot;: &quot;arn:aws:airflow:eu-west-1:xxxxxxxxxxxx:environment/{mwaa-env}&quot;
}
</code></pre>
<p>This will update and then update the environment - so this can take around 10-15 minutes to complete. Go and grab a cup of tea. When we run the previous command to see the status of the environment,</p>
<pre><code>aws mwaa get-environment --name {mwaa-environment} | jq -r '.Environment | .RequirementsS3ObjectVersion'
</code></pre>
<p>We should now see the latest version being used.</p>
<pre><code>V6.0mTeeI0v4ctTubAgvNrGqIdj3b4LV
</code></pre>
<p><strong>Some things to take into consideration</strong></p>
<p>A couple of things to bear in mind when implementing a simple CI/CD workflow like this in MWAA.</p>
<ul>
<li>updates to the requirements.txt and plugin.zip files will require that you update your environment to re-load these changes. They are not automatically re-loaded. You can do this using the &ldquo;aws mwaa update-environment &ndash;name {environment}&rdquo; command but be aware you will need to update the version of the requirements.txt and plugin.zip file</li>
<li>with this sample workflow I have simplified the directory layout and structure - you can easily change this to suit your own needs, just update the corresponding template</li>
<li>this IS a super simple workflow and you probably need to do some more work to make it something you can use. Some suggestions would include adding a build stage to run tests of your workflows, or perhaps staging deployments to different environments. I will come back in a future post and take a look at these</li>
</ul>
<p><strong>Deleting the CI/CD setup</strong></p>
<p>If you are just using this post to understand how this works, and you no longer need the environment then you can easily remove the setup using the following commands. Bear in mind this will destroy all resources, including the CodeCommit environment, so makes copies/backups of anything you want to keep.</p>
<pre><code>aws cloudformation delete-stack --stack-name {your stack name} --region={aws-region}
</code></pre>
<p>This command will not generate any output so you will need to go to the CloudFormation console as this will generate an error - don&rsquo;t worry. You just need to delete the Amazon S3 Artefact bucket, which this process will not do. Once you have done that, re-run the command and it should remove the environment stack from your CloudFormation console.</p>
<p><strong>Conclusion</strong></p>
<p>This concludes the fifth post. You will now be able to setup a simple automated workflow that will help you accelerate your developers whilst reducing the permissions and access you need to give those developers to your MWAA environments. I will come back in a future post and look at more complex pipelines and how you can integrate testing and staged deployments.</p>
<p>In the next post we will look at monitoring and logging, which will help you troubleshoot issues with your Apache Airflow environment and the DAGs you are developing. It will also help you understand over time how your environments are running, a look at resources and capacity and help you optimise your costs to make sure you are right-sizing your environment.</p>
<p>If there is specific content you want to see, please get in touch.</p>

  </main>

          <div class="social-heading">
            <div class="footer-social">
  
    <div class="social-icon">
      <a href="https://twitter.com/094459" target="_blank" title="Twitter">
        <svg xmlns="http://www.w3.org/2000/svg"
aria-label="Twitter" role="img"
viewBox="0 0 512 512"><rect
width="512" height="512"
rx="15%"
fill="#1da1f3"/><path fill="#fff" d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
      </a>
    </div>
  
  
  
    <div class="social-icon">
      <a href="https://github.com/094459" target="_blank" title="GitHub">
        <svg xmlns="http://www.w3.org/2000/svg"
aria-label="GitHub" role="img"
viewBox="0 0 512 512"><rect
width="512" height="512"
rx="15%"
fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
      </a>
    </div>
  
  
    <div class="social-icon">
      <a href="https://www.linkedin.com/in/ricardosueiras" target="_blank" title="Linkedin">
        <svg xmlns="http://www.w3.org/2000/svg"
aria-label="LinkedIn" role="img"
viewBox="0 0 512 512"
fill="#fff"><rect
width="512" height="512"
rx="15%"
fill="#0077b5"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
      </a>
    </div>
  
  
  
    <div class="social-icon">
      <a href="https://www.reddit.com/r/aws" target="_blank" title="Reddit">
        <svg xmlns="http://www.w3.org/2000/svg"
aria-label="Reddit" role="img"
viewBox="0 0 512 512"><rect
width="512" height="512"
rx="15%"
fill="#f40"/><g fill="#fff"><ellipse cx="256" cy="307" rx="166" ry="117"/><circle cx="106" cy="256" r="42"/><circle cx="407" cy="256" r="42"/><circle cx="375" cy="114" r="32"/></g><g stroke-linecap="round" stroke-linejoin="round" fill="none"><path d="m256 196 23-101 73 15" stroke="#fff" stroke-width="16"/><path d="m191 359c33 25 97 26 130 0" stroke="#f40" stroke-width="13"/></g><g fill="#f40"><circle cx="191" cy="287" r="31"/><circle cx="321" cy="287" r="31"/></g></svg>
      </a>
    </div>
  
  
  
  
  
  
  
  
    <div class="social-icon">
      <a href="mailto:ricsue@amazon.com" title="Email">
        <svg xmlns="http://www.w3.org/2000/svg"
aria-label="Email" role="img"
viewBox="0 0 512 512"><rect
width="512" height="512"
rx="15%"
fill="teal"/><rect width="356" height="256" x="78" y="128" fill="#fff" rx="8%"/><path fill="none" stroke="teal" stroke-width="20" d="M434 128L269 292c-7 8-19 8-26 0L78 128m0 256l129-128m227 128L305 256"/></svg>
      </a>
    </div>
  
  
</div>

          </div>
          <footer role="contentinfo">
  <div class="social-footer">
    <div class="footer-social">
  
    <div class="social-icon">
      <a href="https://twitter.com/094459" target="_blank" title="Twitter">
        <svg xmlns="http://www.w3.org/2000/svg"
aria-label="Twitter" role="img"
viewBox="0 0 512 512"><rect
width="512" height="512"
rx="15%"
fill="#1da1f3"/><path fill="#fff" d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
      </a>
    </div>
  
  
  
    <div class="social-icon">
      <a href="https://github.com/094459" target="_blank" title="GitHub">
        <svg xmlns="http://www.w3.org/2000/svg"
aria-label="GitHub" role="img"
viewBox="0 0 512 512"><rect
width="512" height="512"
rx="15%"
fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
      </a>
    </div>
  
  
    <div class="social-icon">
      <a href="https://www.linkedin.com/in/ricardosueiras" target="_blank" title="Linkedin">
        <svg xmlns="http://www.w3.org/2000/svg"
aria-label="LinkedIn" role="img"
viewBox="0 0 512 512"
fill="#fff"><rect
width="512" height="512"
rx="15%"
fill="#0077b5"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
      </a>
    </div>
  
  
  
    <div class="social-icon">
      <a href="https://www.reddit.com/r/aws" target="_blank" title="Reddit">
        <svg xmlns="http://www.w3.org/2000/svg"
aria-label="Reddit" role="img"
viewBox="0 0 512 512"><rect
width="512" height="512"
rx="15%"
fill="#f40"/><g fill="#fff"><ellipse cx="256" cy="307" rx="166" ry="117"/><circle cx="106" cy="256" r="42"/><circle cx="407" cy="256" r="42"/><circle cx="375" cy="114" r="32"/></g><g stroke-linecap="round" stroke-linejoin="round" fill="none"><path d="m256 196 23-101 73 15" stroke="#fff" stroke-width="16"/><path d="m191 359c33 25 97 26 130 0" stroke="#f40" stroke-width="13"/></g><g fill="#f40"><circle cx="191" cy="287" r="31"/><circle cx="321" cy="287" r="31"/></g></svg>
      </a>
    </div>
  
  
  
  
  
  
  
  
    <div class="social-icon">
      <a href="mailto:ricsue@amazon.com" title="Email">
        <svg xmlns="http://www.w3.org/2000/svg"
aria-label="Email" role="img"
viewBox="0 0 512 512"><rect
width="512" height="512"
rx="15%"
fill="teal"/><rect width="356" height="256" x="78" y="128" fill="#fff" rx="8%"/><path fill="none" stroke="teal" stroke-width="20" d="M434 128L269 292c-7 8-19 8-26 0L78 128m0 256l129-128m227 128L305 256"/></svg>
      </a>
    </div>
  
  
</div>

    <label for="themer">
      dark theme: <input type="checkbox" id="themer" class="vh">
      <span aria-hidden="true"></span>
    </label>
  </div>
  
    <p class="margin-top-none">Copyright &copy; <span id="copyright-year"></span> - Ricardo Sueiras</p>
  
  
    <p class="margin-top-none">
    Made with <a href="https://gohugo.io/">Hugo</a>. Themed by <a href="https://github.com/zwbetz-gh/cupper-hugo-theme">Cupper</a>.
    </p>
  
</footer>
<script>
    var year = new Date().getFullYear()
    document.getElementById("copyright-year").innerHTML = year;
</script>

        </div>
      </div>
    </div>
    <script src="https://example.com/js/prism.js"></script>



<script src="https://example.com/js/dom-scripts.js"></script>



<script src="/js/search.7aef046a0cc8b0c532f1d20087b920459bc868c936bb48a6ae221eceefca2d07.js"></script>



    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css" integrity="sha384-dbVIfZGuN1Yq7/1Ocstc1lUEm+AT+/rCkibIcC/OmWo5f0EA48Vf8CytHzGrSwbQ" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js" integrity="sha384-2BKqo+exmr9su6dir+qCw08N2ZKRucY4PrGQPPWU1A7FtlCGjmEGFqXCv5nyM5Ij" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>

  </body>
</html>
